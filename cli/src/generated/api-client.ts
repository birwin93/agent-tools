// AUTO-GENERATED BY backend/src/codegen/generate-client.ts
export type DocFrontmatter = {
  id: string;
  slug: string;
  title: string;
  summary: string;
  project: string | null;
  version: number;
  updatedAt: string;
};

export type DocWithContent = {
  id: string;
  slug: string;
  version: number;
  updatedAt: string;
  frontmatter: { title: string; summary: string; project: string | null };
  content: string;
};

export type CreateDocRequest = {
  slug?: string;
  title: string;
  summary: string;
  content: string;
  project?: string;
};

export type UpdateDocRequest = {
  title?: string;
  summary?: string;
  content?: string;
};

export type ApiError = {
  error: string;
  message: string;
};

export class ApiClient {
  constructor(private config: { baseUrl: string }) {}

  private async request<T>(path: string, init?: RequestInit): Promise<T> {
    const res = await fetch(this.config.baseUrl + path, {
      ...init,
      headers: { "content-type": "application/json", ...(init?.headers || {}) },
    });
    if (!res.ok) {
      const body = await res.text();
      throw new Error("HTTP " + res.status + ": " + body);
    }
    return (await res.json()) as T;
  }

  async listDocs(): Promise<{ docs: DocFrontmatter[] }> {
    return this.request("/api/v1/docs");
  }

  async getDocById(id: string): Promise<DocWithContent> {
    return this.request("/api/v1/docs/:id".replace(":id", id));
  }

  async getDocBySlug(slug: string): Promise<DocWithContent> {
    return this.request("/api/v1/docs/by-slug/:slug".replace(":slug", slug));
  }

  async createDoc(body: CreateDocRequest): Promise<DocWithContent> {
    return this.request("/api/v1/docs", {
      method: "POST",
      body: JSON.stringify(body),
    });
  }

  async updateDoc(id: string, body: UpdateDocRequest): Promise<DocWithContent> {
    return this.request("/api/v1/docs/:id".replace(":id", id), {
      method: "PUT",
      body: JSON.stringify(body),
    });
  }
}
